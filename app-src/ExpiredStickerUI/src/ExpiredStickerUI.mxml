<?xml version="1.0" encoding="utf-8"?>
<s:WindowedApplication xmlns:fx="http://ns.adobe.com/mxml/2009" 
					   xmlns:s="library://ns.adobe.com/flex/spark" 
					   xmlns:mx="library://ns.adobe.com/flex/mx"
					   width="800" height="600"
					   initialize="app_initHandler(event)" creationComplete="app_creationCompleteHandler(event)">
	<fx:Style source="ExpiredStickerUI.css"/>
	<fx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.CalendarLayoutChangeEvent;
			import mx.events.FlexEvent;

			import spark.components.Spinner;
			protected function app_initHandler(event:FlexEvent):void
			{
				;
			}

			protected function selectMFGDate_changeHandler(event:CalendarLayoutChangeEvent):void
			{
				updateExpiredBBDate();
			}

			protected function selectRemainingDate(event:MouseEvent,remaining:int):void
			{
				try{
					resetExpiredBBDate();
					var tgBtn:ToggleButton = event.currentTarget as ToggleButton;
					tgBtn.selected = true;

					this.nsExpBBDate.enabled = tgBtn.id == "tgBtnExpBBCustom" ? true : false;

					_remaining = remaining;
					updateExpiredBBDate();
				}catch(err:Error){
					trace(err.message)
				}
			}
			protected function nsExpBBDate_changeHandler(event:Event,tgBtn:ToggleButton):void{
				if(tgBtn.selected)
				{
					var current:Number = (event.currentTarget as NumericStepper).value;
					isNaN(current) ? this.nsExpBBDate.value = _remaining : _remaining = current;
					updateExpiredBBDate();
				}
			}


			private var _remaining:int = 14;
			private function updateExpiredBBDate():void{
				dfExpBB.selectedDate = dfMFG.selectedDate;
				dfExpBB.selectedDate.time = dfMFG.selectedDate.time + (_remaining * 24 * 60 * 60 * 1000);
			}

			private function resetExpiredBBDate():void{
				var numChild:int = selectedExpBB.numChildren;
				var childObj:Object = null;
				for(var i:int = 0;i < numChild;i++)
				{
					childObj = selectedExpBB.getChildAt(i);
					try{
						var userControl:ToggleButton = childObj as ToggleButton;
						userControl.selected = false;
					}catch(err:Error){
						//trace(err.message);
					}
				}
			}

			protected function app_creationCompleteHandler(event:FlexEvent):void
			{
				initFirstExpiredBB_btn();
				dfExpBB.selectedDate = dfMFG.selectedDate;
				updateExpiredBBDate();
			}

			private function initFirstExpiredBB_btn():void{
				dfMFG.selectedDate = new Date();
				var numChild:int = selectedExpBB.numChildren;
				var childObj:Object = null;
				for(var i:int = 0;i < numChild;i++)
				{
					childObj = selectedExpBB.getChildAt(i);
					try{
						var userControl:ToggleButton = childObj as ToggleButton;
						//trace("This toggle button name is : "+userControl.name+" \nbutton status is : "+userControl.selected);
						userControl.selected = true;
						break;
					}catch(err:Error){
						trace(err.message);
					}
				}
			}
		]]>
	</fx:Script>
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<s:layout>
		<s:VerticalLayout />
	</s:layout>
	<s:Spacer height="40" />
	<s:VGroup width="100%">
		<s:HGroup width="100%" verticalAlign="middle" horizontalAlign="left" gap="0">
			<s:Spacer width="10%" />
			<s:Label fontSize="32" width="20%" text="ผลิต"/>
			<s:Spacer width="5%" />
			<mx:DateField id="dfMFG" 
						  fontSize="48" width="30%"
						  change="selectMFGDate_changeHandler(event)"/>
		</s:HGroup>
		<s:HGroup id="selectedExpBB" width="100%" verticalAlign="middle" horizontalAlign="left" gap="0">
			<s:Spacer width="10%" />
			<s:Label  width="20%" fontSize="32" text="เลือกอายุสินค้า" height="40" />
			<s:Spacer width="5%" />
			<s:ToggleButton cornerRadius="0" fontSize="32" label="14 วัน" height="40" click="selectRemainingDate(event,14)"/>
			<s:ToggleButton cornerRadius="0" fontSize="32" label="7 วัน" height="40" click="selectRemainingDate(event,7)"/>
			<s:ToggleButton id="tgBtnExpBBCustom" cornerRadius="0" fontSize="32" label="กำหนดเอง" height="40"
							click="selectRemainingDate(event,nsExpBBDate.value)"/>
			<s:NumericStepper id="nsExpBBDate" enabled="false"
							  minimum="1" maximum="30000" stepSize="1"
							  fontSize="32" width="15%"
							  change="nsExpBBDate_changeHandler(event,tgBtnExpBBCustom)"/>
			<s:Label fontSize="32" text="วัน" height="40"/>
		</s:HGroup>
		<s:HGroup width="100%" verticalAlign="middle" horizontalAlign="left" gap="0">
			<s:Spacer width="10%" />
			<s:Label fontSize="32" width="20%" text="ควรบริโภคก่อน"/>
			<s:Spacer width="5%" />
			<mx:DateField id="dfExpBB" fontSize="48" width="30%" enabled="false"/>
		</s:HGroup>
	</s:VGroup>
	
</s:WindowedApplication>
